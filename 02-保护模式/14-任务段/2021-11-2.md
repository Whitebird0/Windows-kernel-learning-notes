TSS任务段
---

TSS是一块内存，最小为104个字节

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/20191204211618641.png)

          Previous Task Link 前一个TSS的链接。通过这个字段可以找到上一个TSS
          ESP0：零环的ESP
          SS0：零环的SS
          ESP1：1环的ESP
          SS1：1环的SS
          ESP2：2环的ESP
          SS2：2环的SS
          LDT Segment Seletor：LDT段选择子，保存了LDT表的基址和长度。 这个选择子对应的段描述符必须是系统段描述符。LDT段选择子的数量有多少个取决于TSS有多少个

**TSS的作用**

TSS是CPU设计的东西，与操作系统无关。一个CPU只有一个TSS，TSS存在的意义在于让一个CPU可以同时执行多个任务。但是操作系统并没有使用TSS来进行任务切换，而是直接将任务切换所需要保存的寄存器直接存到了堆栈里。

**如何找到TSS**

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/20191204211540296.png)

CPU里面有一个 TR段寄存器，该寄存器里面存的是TSS段描述符的段选择子。

tr的base就是tss所在的地址，tr的limit就是tss的大小 使用 ltr 特权指令加载tss段描述符

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/QQ%E6%88%AA%E5%9B%BE20211102183722.png)

        拆解后
        index:101  
        Ti:0
        RPL:00
        
![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/QQ%E6%88%AA%E5%9B%BE20211102184052.png)
        
得到tss的段描述符
80008b1e`400020ab

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/1827556-20200307192424093-309783713.png)

          BASE:801e4000
          Limit:20ab

dt _KTSS,查看TSS结构

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/QQ%E6%88%AA%E5%9B%BE20211102185410.png)

        dt _KTSS 801e4000

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/QQ%E6%88%AA%E5%9B%BE20211102185533.png)

